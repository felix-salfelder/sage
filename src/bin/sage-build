#!/usr/bin/env bash

if [ -z "$SAGE_SRC" ]; then
    echo
    echo "SAGE_SRC undefined ... exiting"
    return 1
fi

if [ "$1" = "-b" ]; then
    DO_BUILD_ALL=1
    shift
else
    DO_BUILD_ALL=0
fi

if [ $DO_BUILD_ALL = 1 ]; then
    echo "*** TOUCHING ALL CYTHON (.pyx) FILES ***"
    find "$SAGE_SRC"/sage -name "*.pyx" | xargs touch 2>/dev/null
fi

set -e

#build "sage"
# FIXME: what does "build" really mean?
# wrapping to "install" for now. just build would be useless.

# FIXME: uuh ooh. need sage ("the distribution") unpacked to build.


# maybe call spkg-install build or stage

# build c_lib
make -C "$SAGE_ROOT" src/c_lib-stage

# build sage library
make -C "$SAGE_ROOT" src/sage-stage
