#!/usr/bin/env bash

if [ -z "$SAGE_SRC" ]; then
    echo
    echo "SAGE_SRC undefined ... exiting"
    return 1
fi

# this is not necessary. (if) dependency tracking works.
# make clean if you want to rebuild everything.
if [ $DO_BUILD_ALL = 1 ]; then
   echo "*** TOUCHING ALL CYTHON (.pyx) FILES ***"
   find "$SAGE_SRC"/sage -name "*.pyx" | xargs touch 2>/dev/null
fi

set -e

# (re)build sage(lib)

# better call spkg-install build or stage
# (later)

# build c_lib
make -C "$SAGE_ROOT"/src/c_lib

# build sage library
make -C "$SAGE_ROOT"/src/sage py
