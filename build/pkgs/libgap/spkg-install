#!/usr/bin/env sage-dist-make

DIST_MK = spkg.mk
include $(DIST_MK)

ifeq ($(SAGE64),yes)
    CFLAG64?=-m64
	 CFLAGS+=$(CFLAG64)
	 CXXFLAGS+=$(CFLAG64)
endif

ifeq ($(SAGE_DEBUG),yes)
    # Note that -g3 allows you to use preprocessor macros in gdb which are widely used
    CFLAGS+=-O0 -g3 -DDEBUG_MASTERPOINTERS -DDEBUG_GLOBAL_BAGS -DDEBUG_FUNCTIONS_BAGS
    #  -DDEBUG_HANDLER_REGISTRATION is broken
endif

install: build
	@echo "Installing libGAP..."
	$(MAKE) -C src install INSTALL=sage-dist-install DESTDIR="$(DESTDIR)"

configure:
	@echo "GAP was configured with $(GAParch_system)"
	@echo "Configuring libGAP..."
	cd src;\
	./configure --disable-static CFLAGS="$(CFLAGS)" CXXFLAGS="$(CXXFLAGS)" \
               --with-gap_system_arch="$(GAParch_system)" \
               --with-sage="$(SAGE_LOCAL)" --with-gmp="$(SAGE_LOCAL)" --prefix="$(SAGE_PREFIX)"

build: configure
	@echo "Building libGAP..."
	$(MAKE) -C src

.PHONY: configure build
